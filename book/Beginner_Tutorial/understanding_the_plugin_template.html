<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Understanding the Plugin Template - The Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Installation</div></li><li class="chapter-item expanded "><a href="../dev_env.html"><strong aria-hidden="true">3.</strong> Development Environment</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/core_concepts.html"><strong aria-hidden="true">4.</strong> Core Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Core_Concepts/plugin.html"><strong aria-hidden="true">4.1.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/wasm.html"><strong aria-hidden="true">4.2.</strong> Webassembly</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/entity_component_system.html"><strong aria-hidden="true">4.3.</strong> Entity Component System</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/pub_sub.html"><strong aria-hidden="true">4.4.</strong> Pub/Sub channels</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/client_and_server.html"><strong aria-hidden="true">4.5.</strong> Client and Server</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/crates.html"><strong aria-hidden="true">4.6.</strong> Crates</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/names.html"><strong aria-hidden="true">4.7.</strong> Names</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/coordinate_system.html"><strong aria-hidden="true">4.8.</strong> Coordinate system</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/rendering.html"><strong aria-hidden="true">4.9.</strong> Rendering</a></li><li class="chapter-item expanded "><a href="../Core_Concepts/api_docs.html"><strong aria-hidden="true">4.10.</strong> API documentation</a></li></ol></li><li class="chapter-item expanded "><a href="../Beginner_Tutorial/beginner_plugin_development_tutorial.html"><strong aria-hidden="true">5.</strong> Beginner Plugin Development Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Beginner_Tutorial/setting_up_plugin_development_environment.html"><strong aria-hidden="true">5.1.</strong> Setting up Plugin Development Environment</a></li><li class="chapter-item expanded "><a href="../Beginner_Tutorial/understanding_the_plugin_template.html" class="active"><strong aria-hidden="true">5.2.</strong> Understanding the Plugin Template</a></li><li class="chapter-item expanded "><a href="../Beginner_Tutorial/creating_objects.html"><strong aria-hidden="true">5.3.</strong> Creating Objects</a></li><li class="chapter-item expanded "><a href="../Beginner_Tutorial/adding_object_behaviors.html"><strong aria-hidden="true">5.4.</strong> Adding Object Behaviors</a></li><li class="chapter-item expanded "><a href="../Beginner_Tutorial/configuring_game_settings.html"><strong aria-hidden="true">5.5.</strong> Configuring Game Settings</a></li></ol></li><li class="chapter-item expanded "><a href="../for_engine_developers.html"><strong aria-hidden="true">6.</strong> For Engine developers</a></li><li class="chapter-item expanded "><a href="../quality_of_life.html"><strong aria-hidden="true">7.</strong> Quality Of Life</a></li><li class="chapter-item expanded "><a href="../common_fixes.html"><strong aria-hidden="true">8.</strong> Common fixes</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="plugin-template"><a class="header" href="#plugin-template">Plugin Template</a></h1>
<p>Before we start getting creative with plugin development, lets dive deep into the code to gain a better understanding of what is going on.</p>
<h2 id="plugin-file-structure"><a class="header" href="#plugin-file-structure">Plugin File Structure</a></h2>
<p>The following list is the file structure of the plugin template:</p>
<ul>
<li><code>.cargo</code>
<ul>
<li><code>config.toml</code></li>
</ul>
</li>
<li><code>src</code>
<ul>
<li><code>lib.rs</code></li>
</ul>
</li>
<li><code>.gitignore</code></li>
<li><code>Cargo.toml</code></li>
<li><code>README.md</code></li>
</ul>
<p>New rust developers will be primarily familiar with developing code in <code>main.rs</code>, however plugins are a bit different. Plugins are libraries, so we write code starting from <code>lib.rs</code> instead.</p>
<p>Before we get into the code itself, there is one thing we need to change. This information can be found in the <code>README.md</code> file, but we will go over it here as well.</p>
<h3 id="update-cargotoml-file"><a class="header" href="#update-cargotoml-file">Update Cargo.toml file</a></h3>
<p>Because this code is a template, the code is not fully setup for development. Inside the <code>Cargo.toml</code> file, you will find the following code:</p>
<pre><code class="language-toml">[package]
name = &quot;template_plugin&quot; # CHANGE ME!
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies] # IMPORTANT!
cimvr_common = { git = &quot;https://github.com/ChatImproVR/iteration0.git&quot;, branch = &quot;main&quot; }
cimvr_engine_interface  = { git = &quot;https://github.com/ChatImproVR/iteration0.git&quot;, branch = &quot;main&quot; } 
serde = { version = &quot;1&quot;, features = [&quot;derive&quot;] }
</code></pre>
<p>We need to change the name of the plugin. In this tutorial, it will be <strong>galaga</strong>. If we decide not change the name, the plugin will be compiled as <code>template_plugin.wasm</code>. Not only that, but the name will become important later when we use the <code>pkg_namespace!()</code> macro! <strong>Make sure to pick something descriptive, unique, and long.</strong></p>
<p>Note that in the future, ChatImproVR may be available on crates.io or change it's name in git, in which case you will need to update the <code>[dependencies]</code> section!</p>
<p>Therefore, if we are creating the <strong>galaga</strong> plugin, Cargo.toml should look like:</p>
<pre><code class="language-toml">[package]
name = &quot;galaga&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies]
cimvr_common = { git = &quot;https://github.com/ChatImproVR/iteration0.git&quot;, branch = &quot;main&quot; }
cimvr_engine_interface  = { git = &quot;https://github.com/ChatImproVR/iteration0.git&quot;, branch = &quot;main&quot; }
serde = { version = &quot;1&quot;, features = [&quot;derive&quot;] }
</code></pre>
<h2 id="understanding-librs"><a class="header" href="#understanding-librs">Understanding lib.rs</a></h2>
<p>Let's switch to the main component, <code>lib.rs</code>. The following code should look similar to <code>lib.rs</code> you have. </p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use cimvr_engine_interface::{make_app_state, prelude::*, println};

// All state associated with client-side behaviour
struct ClientState;

impl UserState for ClientState {
    // Implement a constructor
    fn new(io: &amp;mut EngineIo, sched: &amp;mut EngineSchedule&lt;Self&gt;) -&gt; Self {
        println!(&quot;Hello, client!&quot;);

        // NOTE: We are using the println defined by cimvr_engine_interface here, NOT the standard library!
        cimvr_engine_interface::println!(&quot;This prints&quot;);
        std::println!(&quot;But this doesn't&quot;);

        Self
    }
}

// All state associated with server-side behaviour
struct ServerState;

impl UserState for ServerState {
    // Implement a constructor
    fn new(io: &amp;mut EngineIo, sched: &amp;mut EngineSchedule&lt;Self&gt;) -&gt; Self {
        println!(&quot;Hello, server!&quot;);
        Self
    }
}

// Defines entry points for the engine to hook into.
// Calls new() for the appropriate state.
make_app_state!(ClientState, ServerState);
<span class="boring">}</span></code></pre></pre>
<p>Let's go every line in detail what it means in general.</p>
<h3 id="packages"><a class="header" href="#packages">Packages</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use cimvr_engine_interface::{make_app_state, prelude::*, println};
<span class="boring">}</span></code></pre></pre>
<p>The <code>cimvr_engine_interface</code> facilitates communication between the plugin and the host. It does not include any interfacing with the specific features of the client or server; instead these datatyes are relegated to the <code>common</code> crate. The third line does not print out since it is part of the standard library that cimvr is not using. In simple terms, the <code>cimvr_engine_interface</code> is the connector between plugins and the engine itself. </p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>make_app_state!(ClientState, ServerState);
<span class="boring">}</span></code></pre></pre>
<p>The <code>make_app_state!</code> will run and compile the plugin code. In other words, it is the main function of the plugin in order to load into the engine itself.</p>
<h3 id="client"><a class="header" href="#client">Client</a></h3>
<p>If you are not familiar with the idea of Client versus Server, please refer to this <a href="../Core_Concepts/client_and_server.html">page</a> before continue reading this part of the code. At the same time, the implementation utilize the idea of ECS. If you are not familiar with ECS, please refer to this <a href="../Core_Concepts/core_concepts.html#entity-component-system">page</a>.</p>
<p>Before we start implemeting the feature/functionality to the client, we need to declare the client entity. Because there are no required parameter to attached with the client, it will be an empty struct with the name of ClientState. The line below is the method how we will declare it.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ClientState;
<span class="boring">}</span></code></pre></pre>
<p>Now we are going to implement the client side feature/functionality by implementing the idea of UserState. The UserState is define as below.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait UserState: Sized {
    /// Constructor for this state; called once before the **Init** stage.
    fn new(io: &amp;mut EngineIo, sched: &amp;mut EngineSchedule&lt;Self&gt;) -&gt; Self;
}
<span class="boring">}</span></code></pre></pre>
<p>All we need to do is to modify the <code>new</code> function with the same parameter. If we want to add more features that correlates to the client side, we can create other functions that are directly implemented to the ClientState entity, but we will walk over when adding behavior to objects and such. At the same time, we will talk more detail regarding the parameter of the new function.</p>
<p>Within the <code>new</code> function, the template contains the following code.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>println!(&quot;Hello, client!&quot;); // Line 1
cimvr_engine_interface::println!(&quot;This prints&quot;); // Line 2
std::println!(&quot;But this doesn't&quot;); // Line 3

Self // Line 4
<span class="boring">}</span></code></pre></pre>
<p>The first line will print out in the terminal as how any Rust language will print out: the standard <code>println!</code> statement.
The second line will print out in the terminal but differently. While the first line prints out on the terminal/client side, the second line prints the text on the engine side itself. </p>
<p>The last line is the returning the client UserState as the updated the version for the client.</p>
<p>Which makes up the entire code for the client side itself.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl UserState for ClientState {
    // Implement a constructor
    fn new(io: &amp;mut EngineIo, sched: &amp;mut EngineSchedule&lt;Self&gt;) -&gt; Self {
        println!(&quot;Hello, client!&quot;);

        // NOTE: We are using the println defined by cimvr_engine_interface here, NOT the standard library!
        cimvr_engine_interface::println!(&quot;This prints&quot;);
        std::println!(&quot;But this doesn't&quot;);

        Self
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="server"><a class="header" href="#server">Server</a></h3>
<p>If you are not familiar with the idea of Client versus Server, please refer to this <a href="../Core_Concepts/client_and_server.html">page</a> before continue reading this part of the code. At the same time, the implementation utilize the idea of ECS. If you are not familiar with ECS, please refer to this <a href="../Core_Concepts/core_concepts.html#entity-component-system">page</a>.</p>
<p>If you have read the client section, the server side present the same idea itself: printing out on the terminal.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// All state associated with server-side behaviour
struct ServerState;

impl UserState for ServerState {
    // Implement a constructor
    fn new(io: &amp;mut EngineIo, sched: &amp;mut EngineSchedule&lt;Self&gt;) -&gt; Self {
        println!(&quot;Hello, server!&quot;);
        Self
    }
}
<span class="boring">}</span></code></pre></pre>
<p>In conclusion, the template prints out text in the terminal for both client and server side. In the next section, we will discuss on how to create object in the space and focus on creating both 3D and 2D objects.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Beginner_Tutorial/setting_up_plugin_development_environment.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../Beginner_Tutorial/creating_objects.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Beginner_Tutorial/setting_up_plugin_development_environment.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../Beginner_Tutorial/creating_objects.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
